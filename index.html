<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Paws & Whiskers - Pet Store Engagement App</title>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;700&display=swap" rel="stylesheet">
  <style>
    html, body {
      height: 100%;
      width: 100%;
      margin: 0;
      padding: 0;
      font-size: 18px;
      background: #f5f5f5;
      color: #2d2d2d;
      box-sizing: border-box;
    }
    body {
      min-height: 100vh;
      width: 100vw;
      font-family: 'Quicksand', Arial, sans-serif;
      overflow-x: hidden;
      background: #f5f5f5;
    }
    .main-layout {
      display: flex;
      flex-direction: row;
      justify-content: center;
      align-items: flex-start;
      width: 100vw;
      min-height: 100vh;
      gap: 2.5rem;
      padding: 0 0 2rem 0;
    }
    .side-space {
      flex: 1 1 0;
      min-width: 40px;
      max-width: 120px;
      height: 100%;
      background: transparent;
    }
    .container {
      flex: 2 1 700px;
      max-width: 900px;
      width: 100%;
      margin: 2.5rem 0 2rem 0;
      background: rgba(255,255,255,0.97);
      border-radius: 20px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.18);
      padding: 2.5rem 2.5rem 2rem 2.5rem;
      backdrop-filter: blur(6px);
      animation: fadeIn 1.2s;
    }
    @media (max-width: 1100px) {
      .main-layout { flex-direction: column; gap: 0; }
      .side-space { display: none; }
      .container { margin: 1.5rem auto; }
    }
    @media (max-width: 700px) {
      .container { padding: 1rem; }
      html, body { font-size: 15px; }
    }
    h1, h2, h3, h4, h5 {
      color: #3b2e2a;
      font-weight: 700;
      letter-spacing: 1px;
      margin-bottom: 0.5rem;
    }
    h1 { font-size: 2.7rem; text-align: center; }
    h2 { font-size: 1.5rem; }
    .pet-emoji {
      font-size: 2.5rem;
      display: block;
      text-align: center;
      margin-bottom: 1.2rem;
      animation: bounce 1.5s infinite alternate;
    }
    @keyframes bounce {
      0% { transform: translateY(0); }
      100% { transform: translateY(-10px); }
    }
    /* HERO CAROUSEL Netflix/Amazon style */
    .hero-carousel {
      width: 100vw;
      min-height: 420px;
      max-height: 540px;
      position: relative;
      margin: 0 0 2.5rem 0;
      overflow: hidden;
      border-radius: 0 0 32px 32px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.13);
      display: flex;
      align-items: flex-end;
      justify-content: flex-start;
    }
    .hero-slide {
      position: absolute;
      top: 0; left: 0;
      width: 100vw;
      height: 100%;
      background-size: cover;
      background-position: center;
      opacity: 0;
      transition: opacity 1s;
      z-index: 1;
      display: flex;
      align-items: flex-end;
    }
    .hero-slide.active {
      opacity: 1;
      z-index: 2;
    }
    .hero-overlay {
      background: linear-gradient(90deg,rgba(30,30,30,0.88) 0%,rgba(30,30,30,0.18) 80%);
      color: #fff;
      padding: 3.2rem 4.2rem 3.2rem 2.8rem;
      border-radius: 0 0 38px 0;
      max-width: 700px;
      min-width: 320px;
      margin: 0 0 2.5rem 2.5rem;
      box-shadow: 0 2px 12px rgba(44,62,80,0.10);
      position: relative;
      font-size: 1.25rem;
    }
    .hero-title { font-size: 2.5rem; font-weight: 700; margin-bottom: 1.1rem; }
    .hero-desc { font-size: 1.25rem; line-height: 1.6; }
    .hero-carousel-controls {
      position: absolute;
      bottom: 2.5rem;
      left: 2.5rem;
      z-index: 10;
      display: flex;
      gap: 1.2rem;
    }
    .hero-carousel-btn {
      background: rgba(255,255,255,0.7);
      border: none;
      border-radius: 50%;
      width: 44px;
      height: 44px;
      font-size: 1.7rem;
      color: #ff9800;
      box-shadow: 0 2px 8px #ffe082;
      cursor: pointer;
      transition: background 0.2s;
    }
    .hero-carousel-btn:hover { background: #ffe082; }
    label {
      font-weight: 700;
      color: #5a463a;
      margin-bottom: 0.2rem;
      display: block;
      font-size: 1.1rem;
    }
    input, textarea {
      width: 100%;
      padding: 1rem;
      margin: 0.4rem 0 1.2rem 0;
      border: 1.5px solid #e0d5cf;
      border-radius: 8px;
      font-size: 1.1rem;
      font-family: inherit;
      background: #f9f6f3;
      transition: border 0.3s, box-shadow 0.3s;
    }
    input:focus, textarea:focus {
      border-color: #ffb347;
      box-shadow: 0 0 0 2px #ffe0b2;
      outline: none;
    }
    button {
      width: 100%;
      padding: 1rem;
      background: linear-gradient(90deg, #ffb347 0%, #ffcc80 100%);
      color: #3b2e2a;
      border: none;
      border-radius: 8px;
      font-size: 1.2rem;
      font-weight: 700;
      cursor: pointer;
      margin-bottom: 1rem;
      box-shadow: 0 2px 8px rgba(255,179,71,0.08);
      transition: background 0.3s, transform 0.2s;
    }
    button:hover {
      background: linear-gradient(90deg, #ffcc80 0%, #ffb347 100%);
      transform: translateY(-2px) scale(1.03);
    }
    .dark-toggle {
      position: fixed;
      top: 22px;
      right: 22px;
      z-index: 100;
      background: linear-gradient(90deg,#23272f 60%,#444 100%);
      border-radius: 30px;
      box-shadow: 0 2px 8px #ffe082;
      padding: 0.5rem 1.2rem 0.5rem 0.8rem;
      display: flex;
      align-items: center;
      gap: 0.7rem;
      font-size: 1.2rem;
      font-weight: 700;
      cursor: pointer;
      border: 2px solid #ffb347;
      transition: background 0.3s, border 0.3s;
    }
    .dark-toggle input[type="checkbox"] {
      width: 1.7em;
      height: 1.7em;
      accent-color: #ffe082;
      margin-right: 0.5em;
      cursor: pointer;
      border-radius: 50%;
      box-shadow: 0 1px 4px #ffe082;
    }
    .dark-toggle span {
      color: #ffb347;
      font-size: 1.25em;
      font-weight: 700;
      letter-spacing: 1px;
    }
    .dark-toggle:hover {
      background: linear-gradient(90deg,#444 60%,#23272f 100%);
      border: 2px solid #ffe082;
    }
    /* Modal for spin result */
    .modal {
      display: none;
      position: fixed;
      z-index: 200;
      left: 0; top: 0;
      width: 100vw; height: 100vh;
      background: rgba(0,0,0,0.45);
      align-items: center;
      justify-content: center;
    }
    .modal-content {
      background: #fffbe7;
      color: #3b2e2a;
      padding: 2rem 2.5rem;
      border-radius: 18px;
      box-shadow: 0 4px 24px #ffe082;
      font-size: 1.3rem;
      text-align: center;
      max-width: 90vw;
      min-width: 260px;
      font-weight: 700;
      position: relative;
    }
    .modal-content button {
      width: auto;
      margin-top: 1.2rem;
      padding: 0.7rem 2.2rem;
      font-size: 1.1rem;
    }
    /* Spin wheel text fix */
    .spin-label {
      font-size: 1.2rem;
      font-weight: 700;
      text-align: center;
      width: 90px;
      word-break: break-word;
      line-height: 1.2;
      color: #3b2e2a;
    }
    .dark-mode .spin-label { color: #ffe082; }
    /* Dark mode overrides */
    body.dark-mode, .dark-mode body {
      background: linear-gradient(120deg,#23272f 0%,#181a1b 100%) !important;
      color: #ffe082 !important;
    }
    .dark-mode .container {
      background: #23272f !important;
      color: #ffe082 !important;
    }
    .dark-mode h1, .dark-mode h2, .dark-mode h3, .dark-mode h4, .dark-mode h5 {
      color: #ffe082 !important;
    }
    .dark-mode .hero-overlay {
      background: linear-gradient(90deg,rgba(30,30,30,0.98) 0%,rgba(30,30,30,0.55) 80%);
      color: #ffe082 !important;
    }
    .dark-mode .modal-content {
      background: #23272f !important;
      color: #ffe082 !important;
    }
    .dark-mode .promo-list li, .dark-mode .loyalty, .dark-mode #petFactSection, .dark-mode #surveySection {
      background: #23272f !important;
      color: #ffe082 !important;
    }
    .dark-mode .carousel-slide .desc {
      color: #ffe082 !important;
    }
    .dark-toggle {
      background: #23272f !important;
      color: #ffe082 !important;
      border: 2px solid #ffe082 !important;
    }
    .dark-toggle:hover {
      background: #444 !important;
      border: 2px solid #ffb347 !important;
    }
    /* Animated Paw Prints (fixed) */
    #pawCanvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      pointer-events: none;
      z-index: 0;
    }
  </style>
</head>
<body>
  <div class="dark-toggle" id="darkModeToggle">
    <input type="checkbox" id="toggleDark" />
    <span>üåô Dark Mode</span>
  </div>
  <div class="hero-carousel" id="heroCarousel">
    <!-- Slides will be injected by JS -->
    <div class="hero-carousel-controls">
      <button class="hero-carousel-btn" id="heroPrev">&#8592;</button>
      <button class="hero-carousel-btn" id="heroNext">&#8594;</button>
    </div>
  </div>
  <div class="main-layout">
    <div class="side-space"></div>
    <div class="container">
      <span class="pet-emoji">üê∂üê±üêæ</span>
      <h1 id="welcomeTitle">Welcome to Paws & Whiskers</h1>
      <div id="welcomeBackMsg" style="display:none;text-align:center;font-size:1.2rem;margin-bottom:1.2rem;"></div>
      <!-- Pet of the Month -->
      <div id="petMonthSection" class="section" style="background:#f3f8ff;border-radius:12px;padding:1rem 0 1.2rem 0;margin-bottom:1.5rem;box-shadow:0 2px 8px rgba(44,62,80,0.06);text-align:center;">
        <h2 style="color:#4a90e2;font-size:1.2rem;margin-bottom:0.7rem;">üêæ Pet of the Month</h2>
        <img id="petMonthImg" src="" alt="Pet of the Month" style="width:120px;height:120px;object-fit:cover;border-radius:50%;box-shadow:0 2px 8px #b3e5fc;margin-bottom:0.5rem;">
        <div style="font-weight:700;font-size:1.1rem;" id="petMonthName"></div>
        <div style="font-size:0.98rem;color:#555;" id="petMonthDesc"></div>
      </div>
      <!-- Registration -->
      <div id="registrationSection" class="section">
        <label for="name">Your Name</label>
        <input type="text" id="name" placeholder="Enter your name" required />
        <label for="email">Your Email</label>
        <input type="email" id="email" placeholder="Enter your email" required />
        <label for="petName">Your Pet's Name</label>
        <input type="text" id="petName" placeholder="Pet's name (optional)" />
        <label for="petBirthday">Pet's Birthday</label>
        <input type="date" id="petBirthday" />
        <button id="registerBtn">Register</button>
      </div>
      <!-- Promotions, Loyalty, Badges, Spin Wheel, Survey, Feedback -->
      <div id="promoSection" class="section" style="display:none;">
        <h2 style="text-align:center; color:#ff9800;">Current Promotions</h2>
        <ul id="promoList" class="promo-list"></ul>
        <!-- Spin the Wheel (fixed) -->
        <div style="margin:1.5rem 0;text-align:center;">
          <h2 style="color:#e67e22;font-size:1.3rem;">üé∞ Spin-the-Wheel Discount</h2>
          <canvas id="spinWheel" width="260" height="260" style="margin-bottom:0.5rem;background:#fffbe7;border-radius:50%;box-shadow:0 2px 8px #ffe082;"></canvas><br>
          <button id="spinBtn">Spin the Wheel!</button>
          <div id="spinResult" style="margin-top:0.7rem;font-weight:700;color:#388e3c;"></div>
        </div>
        <!-- Loyalty, Mood, Badges -->
        <div class="loyalty" id="loyaltyStatus"></div>
        <div id="badgesSection" style="text-align:center;margin-bottom:1.2rem;"></div>
        <!-- Pet Birthday Reminder -->
        <div id="petBirthdayMsg" style="text-align:center;color:#e67e22;font-weight:700;margin-bottom:1rem;"></div>
        <!-- Fun Fact Generator -->
        <div id="petFactSection" style="background:#fffbe7;border-radius:10px;padding:0.7rem 1rem;margin-bottom:1.2rem;text-align:center;font-size:1.05rem;color:#7c5c3b;">
          <span style="font-weight:700;">üêï Did you know?</span> <span id="petFact"></span>
          <button id="newFactBtn" style="margin-left:0.7rem;padding:0.2rem 0.7rem;font-size:0.9rem;width:auto;">üîÑ</button>
        </div>
        <!-- Mini Survey -->
        <div id="surveySection" style="background:#f3f8ff;border-radius:10px;padding:1rem 1rem 0.5rem 1rem;margin-bottom:1.2rem;">
          <div style="font-weight:700;margin-bottom:0.5rem;">Mini Survey: What's your pet's favorite?</div>
          <form id="surveyForm">
            <label><input type="radio" name="fav" value="Food" required> Food</label><br>
            <label><input type="radio" name="fav" value="Toys"> Toys</label><br>
            <label><input type="radio" name="fav" value="Grooming"> Grooming</label><br>
            <label><input type="radio" name="fav" value="Walks"> Walks</label><br>
            <button type="submit" style="margin-top:0.7rem;">Submit Survey</button>
          </form>
          <div id="surveyMsg" style="color:#388e3c;font-weight:700;margin-top:0.5rem;display:none;">You're a true pet lover! üêæ</div>
        </div>
        <!-- Feedback -->
        <h2 style="text-align:center; color:#ff9800;">Feedback</h2>
        <textarea id="feedbackInput" placeholder="Share your feedback or pet story!"></textarea>
        <button id="submitFeedbackBtn">Submit Feedback</button>
        <div class="feedback-success" id="feedbackSuccess">Thank you for your feedback! üêæ</div>
      </div>
    </div>
    <div class="side-space"></div>
  </div>
  <!-- Modal for spin result -->
  <div class="modal" id="spinModal">
    <div class="modal-content" id="spinModalContent">
      <div id="spinModalText"></div>
      <button onclick="document.getElementById('spinModal').style.display='none'">Close</button>
    </div>
  </div>
  <!-- Animated Paw Prints (fixed) -->
  <canvas id="pawCanvas"></canvas>
  <script>
    const promotions = [
      { text: "10% off on all dog food!", emoji: "üê∂" },
      { text: "Buy 1 Get 1 Free on Cat Toys", emoji: "üê±" },
      { text: "Free grooming session with every 5th visit!", emoji: "üõÅ" },
      { text: "New arrivals: Exotic Birds!", emoji: "ü¶ú" }
    ];

    const registerBtn = document.getElementById('registerBtn');
    const promoSection = document.getElementById('promoSection');
    const registrationSection = document.getElementById('registrationSection');
    const promoList = document.getElementById('promoList');
    const loyaltyStatus = document.getElementById('loyaltyStatus');
    const feedbackInput = document.getElementById('feedbackInput');
    const submitFeedbackBtn = document.getElementById('submitFeedbackBtn');
    const feedbackSuccess = document.getElementById('feedbackSuccess');
    const spinBtn = document.getElementById('spinBtn');
    const spinResult = document.getElementById('spinResult');
    const petMonthSection = document.getElementById('petMonthSection');
    const petMonthImg = document.getElementById('petMonthImg');
    const petMonthName = document.getElementById('petMonthName');
    const petMonthDesc = document.getElementById('petMonthDesc');
    const newFactBtn = document.getElementById('newFactBtn');
    const petFact = document.getElementById('petFact');
    const surveyForm = document.getElementById('surveyForm');
    const surveyMsg = document.getElementById('surveyMsg');
    const toggleDark = document.getElementById('toggleDark');
    const welcomeBackMsg = document.getElementById('welcomeBackMsg');

    // Dark mode toggle
    toggleDark.onchange = () => {
      document.body.classList.toggle('dark-mode', toggleDark.checked);
      localStorage.setItem('darkMode', toggleDark.checked);
    };

    function loadPromotions() {
      promoList.innerHTML = '';
      promotions.forEach(promo => {
        const li = document.createElement('li');
        li.innerHTML = `<span>${promo.emoji}</span> ${promo.text}`;
        promoList.appendChild(li);
      });
    }

    function updateLoyalty() {
      let visits = parseInt(localStorage.getItem('visits') || '0');
      let nextReward = 5 - (visits % 5);
      loyaltyStatus.innerHTML = `üêæ You have visited us <b>${visits}</b> time(s).<br>Visit <b>${nextReward}</b> more time(s) to earn a free treat for your pet!`;
      loyaltyStatus.style.background = visits % 5 === 0 && visits !== 0 ? '#ffe0b2' : '#e1f7fa';
      loyaltyStatus.style.color = visits % 5 === 0 && visits !== 0 ? '#ff9800' : '#2d5a5c';
      if (visits % 5 === 0 && visits !== 0) {
        loyaltyStatus.innerHTML += '<br>üéâ Congratulations! You earned a free treat! üéâ';
      }
    }

    function showPetOfTheMonth() {
      const petOfTheMonth = JSON.parse(localStorage.getItem('petOfTheMonth'));
      if (petOfTheMonth) {
        petMonthImg.src = petOfTheMonth.img;
        petMonthName.innerText = petOfTheMonth.name;
        petMonthDesc.innerText = petOfTheMonth.desc;
        petMonthSection.style.display = 'block';
      }
    }

    registerBtn.onclick = () => {
      const name = document.getElementById('name').value.trim();
      const email = document.getElementById('email').value.trim();
      const petName = document.getElementById('petName').value.trim();
      const petBirthday = document.getElementById('petBirthday').value.trim();
      if (name && email) {
        localStorage.setItem('customerName', name);
        localStorage.setItem('customerEmail', email);
        if (petName) localStorage.setItem('petName', petName);
        if (petBirthday) localStorage.setItem('petBirthday', petBirthday);
        let visits = parseInt(localStorage.getItem('visits') || '0');
        if (!visits) localStorage.setItem('visits', '1');
        registrationSection.style.display = 'none';
        promoSection.style.display = 'block';
        loadPromotions();
        updateLoyalty();
        showPetOfTheMonth();
        welcomeBackMsg.style.display = 'block';
        welcomeBackMsg.innerText = `Welcome back, ${name}!`;
      } else {
        alert('Please enter both name and email.');
      }
    };

    submitFeedbackBtn.onclick = () => {
      const feedback = feedbackInput.value.trim();
      if (feedback) {
        let feedbacks = JSON.parse(localStorage.getItem('feedbacks') || '[]');
        feedbacks.push({ name: localStorage.getItem('customerName'), feedback, date: new Date().toISOString() });
        localStorage.setItem('feedbacks', JSON.stringify(feedbacks));
        feedbackInput.value = '';
        feedbackSuccess.style.display = 'block';
        setTimeout(() => { feedbackSuccess.style.display = 'none'; }, 2000);
      } else {
        alert('Please enter your feedback before submitting.');
      }
    };

    // Spin the Wheel functionality
    spinBtn.onclick = () => {
      const randomDegree = Math.floor(Math.random() * 360 + 720);
      const wheel = document.getElementById('spinWheel');
      wheel.style.transition = 'transform 4s cubic-bezier(0.33, 1, 0.68, 1)';
      wheel.style.transform = `rotate(${randomDegree}deg)`;
      const rewardIndex = Math.floor((randomDegree % 360) / (360 / promotions.length));
      setTimeout(() => {
        spinResult.innerText = `You won: ${promotions[rewardIndex].text}`;
        let visits = parseInt(localStorage.getItem('visits') || '0');
        localStorage.setItem('visits', (visits + 1).toString());
        updateLoyalty();
      }, 4000);
    };

    // Fun Fact Generator
    newFactBtn.onclick = () => {
      const facts = [
        "Dogs' sense of smell is about 40 times better than humans'.",
        "Cats can make over 100 different sounds.",
        "Goldfish can remember things for up to five months.",
        "Parrots are known to be great at mimicking human speech.",
        "Hamsters can run up to 8 miles on a wheel in one night!",
        "Rabbits' teeth never stop growing.",
        "Guinea pigs are social animals and enjoy the company of their kind.",
        "Chinchillas have the softest fur of any land mammal.",
        "Ferrets are known for their playful and curious nature.",
        "Turtles can breathe through their butts (cloacal respiration)."
      ];
      const randomFact = facts[Math.floor(Math.random() * facts.length)];
      petFact.innerText = randomFact;
    };

    // Mini Survey submission
    surveyForm.onsubmit = (e) => {
      e.preventDefault();
      const formData = new FormData(surveyForm);
      const favorite = formData.get('fav');
      localStorage.setItem('petFavorite', favorite);
      surveyMsg.style.display = 'block';
      setTimeout(() => { surveyMsg.style.display = 'none'; }, 2000);
    };

    // Simulate a visit every time the user loads the app after registration
    function incrementVisit() {
      if (localStorage.getItem('customerName')) {
        let visits = parseInt(localStorage.getItem('visits') || '0');
        localStorage.setItem('visits', (visits + 1).toString());
      }
    }

    // Auto-load if already registered
    if (localStorage.getItem('customerName')) {
      registrationSection.style.display = 'none';
      promoSection.style.display = 'block';
      incrementVisit();
      loadPromotions();
      updateLoyalty();
      showPetOfTheMonth();
      const registeredName = localStorage.getItem('customerName');
      welcomeBackMsg.style.display = 'block';
      welcomeBackMsg.innerText = `Welcome back, ${registeredName}!`;
    }

    // Load dark mode preference
    if (localStorage.getItem('darkMode') === 'true') {
      toggleDark.checked = true;
      document.body.classList.add('dark-mode');
    }

    // --- JS for all features ---
    // HERO CAROUSEL DATA & LOGIC
    const heroSlides = [
      {
        bg: 'https://images.unsplash.com/photo-1518715308788-3005759c61d3?auto=format&fit=crop&w=1400&q=80',
        title: 'Grooming & Spa',
        desc: 'Pamper your pets with our professional grooming and spa treatments. Our experts ensure your furry friends look and feel their best.',
        img: 'https://images.unsplash.com/photo-1518715308788-3005759c61d3?auto=format&fit=crop&w=900&q=80'
      },
      {
        bg: 'https://images.unsplash.com/photo-1518717758536-85ae29035b6d?auto=format&fit=crop&w=1400&q=80',
        title: 'Health Checkups',
        desc: 'Regular checkups and vaccination clinics by certified vets. Keep your pets healthy and happy with our caring team.',
        img: 'https://images.unsplash.com/photo-1518717758536-85ae29035b6d?auto=format&fit=crop&w=900&q=80'
      },
      {
        bg: 'https://images.unsplash.com/photo-1508672019048-805c876b67e2?auto=format&fit=crop&w=1400&q=80',
        title: 'Premium Pet Foods',
        desc: 'Wide selection of nutritious foods and treats for all pets. Only the best for your companions!',
        img: 'https://images.unsplash.com/photo-1508672019048-805c876b67e2?auto=format&fit=crop&w=900&q=80'
      },
      {
        bg: 'https://images.unsplash.com/photo-1518715308788-3005759c61d3?auto=format&fit=crop&w=1400&q=80',
        title: 'Fun Events',
        desc: 'Pet birthday parties, training workshops, and adoption drives. Join our community and celebrate your pets!',
        img: 'https://images.unsplash.com/photo-1518715308788-3005759c61d3?auto=format&fit=crop&w=900&q=80'
      },
      {
        bg: 'https://images.unsplash.com/photo-1518715308788-3005759c61d3?auto=format&fit=crop&w=1400&q=80',
        title: 'Accessories & Toys',
        desc: 'Toys, beds, leashes, and more for every pet personality. Shop our curated collection!',
        img: 'https://images.unsplash.com/photo-1518715308788-3005759c61d3?auto=format&fit=crop&w=900&q=80'
      }
    ];
    const heroCarousel = document.getElementById('heroCarousel');
    let heroIdx = 0;
    // Refactored: create slides once, toggle active class
    function createHeroSlides() {
      heroSlides.forEach((slide, i) => {
        const div = document.createElement('div');
        div.className = 'hero-slide' + (i===0?' active':'');
        div.style.backgroundImage = `url('${slide.bg}')`;
        div.innerHTML = `<div class='hero-overlay'><div class='hero-title'>${slide.title}</div><div class='hero-desc'>${slide.desc}</div><img src='${slide.img}' alt='' style='width:120px;height:120px;object-fit:cover;border-radius:18px;margin-top:1.5rem;box-shadow:0 2px 8px #ffe082;'></div>`;
        heroCarousel.insertBefore(div, heroCarousel.querySelector('.hero-carousel-controls'));
      });
    }
    function showHero(idx) {
      const slides = heroCarousel.querySelectorAll('.hero-slide');
      slides.forEach((slide, i) => {
        slide.classList.toggle('active', i === idx);
      });
    }
    if (!heroCarousel.querySelector('.hero-slide')) createHeroSlides();
    document.getElementById('heroPrev').onclick = function() {
      heroIdx = (heroIdx-1+heroSlides.length)%heroSlides.length;
      showHero(heroIdx);
    };
    document.getElementById('heroNext').onclick = function() {
      heroIdx = (heroIdx+1)%heroSlides.length;
      showHero(heroIdx);
    };
    setInterval(()=>{ heroIdx=(heroIdx+1)%heroSlides.length; showHero(heroIdx); }, 4000);
    showHero(heroIdx);

    // --- SPIN WHEEL FIXES ---
    // Define spinRewards
    const spinRewards = [
      { label: '10% Off Food', color: '#ffe082' },
      { label: 'Free Toy', color: '#b3e5fc' },
      { label: 'Grooming Discount', color: '#ffd180' },
      { label: 'Bonus Loyalty Point', color: '#c8e6c9' },
      { label: 'Mystery Gift', color: '#f8bbd0' },
      { label: '5% Off Next Visit', color: '#fff9c4' }
    ];
    // Draw wheel on load and after dark mode toggle
    function drawWheel(angle=0) {
      const ctx = document.getElementById('spinWheel').getContext('2d');
      ctx.clearRect(0,0,260,260);
      const n = spinRewards.length;
      const isDark = document.body.classList.contains('dark-mode');
      for(let i=0;i<n;i++){
        ctx.save();
        ctx.beginPath();
        ctx.moveTo(130,130);
        ctx.arc(130,130,120,2*Math.PI*i/n+angle,2*Math.PI*(i+1)/n+angle);
        ctx.closePath();
        ctx.fillStyle = spinRewards[i].color;
        ctx.fill();
        ctx.translate(130,130);
        ctx.rotate(2*Math.PI*(i+0.5)/n+angle);
        ctx.textAlign='center';ctx.font='bold 17px Quicksand';
        ctx.fillStyle = isDark ? '#ffe082' : '#3b2e2a';
        let label = spinRewards[i].label;
        // Wrap text for better fit
        let words = label.split(' ');
        let lines = [];
        let line = '';
        for(let w=0;w<words.length;w++){
          let test = line + (line?' ':'') + words[w];
          if(test.length>13){ lines.push(line); line=words[w]; }
          else line=test;
        }
        if(line) lines.push(line);
        lines.forEach((line,li)=>ctx.fillText(line,70,li*20-10));
        ctx.restore();
      }
      // Arrow
      ctx.beginPath();ctx.moveTo(130,20);ctx.lineTo(120,50);ctx.lineTo(140,50);ctx.closePath();ctx.fillStyle="#e67e22";ctx.fill();
    }
    // Fallback for setDarkMode
    if (typeof setDarkMode !== 'function') {
      window.setDarkMode = function(on) {
        document.body.classList.toggle('dark-mode', on);
      };
    }
    // Redraw wheel on dark mode toggle
    const origSetDarkMode = setDarkMode;
    setDarkMode = function(on) {
      origSetDarkMode(on);
      drawWheel();
    };
    // Draw wheel on load
    drawWheel();
    // Spin logic using spinRewards
    let spinning = false;
    document.getElementById('spinBtn').onclick = function(){
      if(spinning) return;
      spinning=true;document.getElementById('spinResult').textContent='';
      let angle=0,speed=0.35+Math.random()*0.2,decay=0.985+Math.random()*0.005,steps=0;
      function animate(){
        angle+=speed;speed*=decay;steps++;
        drawWheel(angle);
        if(speed>0.01||steps<60){requestAnimationFrame(animate);}else{
          drawWheel(angle); // ensure final redraw
          let idx = Math.floor(((2*Math.PI-angle%(2*Math.PI))/(2*Math.PI))*spinRewards.length)%spinRewards.length;
          let reward = spinRewards[idx].label;
          localStorage.setItem('spinReward',reward);
          document.getElementById('spinResult').textContent = '';
          document.getElementById('spinModalText').textContent = 'You won: '+reward;
          document.getElementById('spinModal').style.display = 'flex';
          spinning=false;
        }
      }
      animate();
    };
    // Carousel logic
    const slides = document.querySelectorAll('.carousel-slide');
    let currentSlide = 0;
    function showSlide(idx) {
      slides.forEach((slide, i) => {
        slide.classList.toggle('active', i === idx);
      });
    }
    document.getElementById('carouselPrev').onclick = function() {
      currentSlide = (currentSlide - 1 + slides.length) % slides.length;
      showSlide(currentSlide);
    };
    document.getElementById('carouselNext').onclick = function() {
      currentSlide = (currentSlide + 1) % slides.length;
      showSlide(currentSlide);
    };
    setInterval(() => {
      currentSlide = (currentSlide + 1) % slides.length;
      showSlide(currentSlide);
    }, 3500);
    // Touch swipe support
    let startX = null;
    document.getElementById('serviceCarousel').addEventListener('touchstart', e => {
      startX = e.touches[0].clientX;
    });
    document.getElementById('serviceCarousel').addEventListener('touchend', e => {
      if(startX === null) return;
      let dx = e.changedTouches[0].clientX - startX;
      if(Math.abs(dx) > 40) {
        if(dx > 0) document.getElementById('carouselPrev').click();
        else document.getElementById('carouselNext').click();
      }
      startX = null;
    });
  </script>
</body>
</html>
